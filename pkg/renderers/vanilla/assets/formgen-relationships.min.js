/**
 * formgen relationship runtime
 * DO NOT EDIT: generated via `npm run build`
 */
"use strict";var FormgenRelationships=(()=>{var re=Object.defineProperty;var ft=Object.getOwnPropertyDescriptor;var ht=Object.getOwnPropertyNames;var mt=Object.prototype.hasOwnProperty;var gt=(e,t)=>{for(var n in t)re(e,n,{get:t[n],enumerable:!0})},vt=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of ht(t))!mt.call(e,o)&&o!==n&&re(e,o,{get:()=>t[o],enumerable:!(r=ft(t,o))||r.enumerable});return e};var yt=e=>vt(re({},"__esModule",{value:!0}),e);var cn={};gt(cn,{RUNTIME_VERSION:()=>oe,Resolver:()=>A,ResolverRegistry:()=>w,getThemeClasses:()=>R,initComponents:()=>X,initRelationships:()=>Jt,registerComponent:()=>st,registerThemeClasses:()=>Je,resetComponentRegistryForTests:()=>at,resetGlobalRegistry:()=>Qt});var oe="0.0.15",Te="__formgenRuntimeVersionAnnounced__";function bt(){if(typeof globalThis=="undefined")return;let e=globalThis;if(e[Te]||(e[Te]=!0,typeof console=="undefined"))return;let t=typeof console.info=="function"?console.info:console.log;typeof t=="function"&&t(`[formgen-relationships] runtime version ${oe}`)}bt();var ie={strategy:"memory",ttlMs:3e5},M={baseUrl:"",cache:ie,logger:void 0,searchThrottleMs:250,searchDebounceMs:250,retryAttempts:1,retryDelayMs:300},se=M;function ae(e={}){var n;let t={...M,...e,cache:{...ie,...(n=e.cache)!=null?n:{}}};return t.cache.strategy||(t.cache.strategy="memory"),(typeof t.cache.ttlMs!="number"||Number.isNaN(t.cache.ttlMs))&&(t.cache.ttlMs=ie.ttlMs),(typeof t.searchThrottleMs!="number"||t.searchThrottleMs<0)&&(t.searchThrottleMs=M.searchThrottleMs),(typeof t.searchDebounceMs!="number"||t.searchDebounceMs<0)&&(t.searchDebounceMs=M.searchDebounceMs),(typeof t.retryAttempts!="number"||t.retryAttempts<0)&&(t.retryAttempts=M.retryAttempts),(typeof t.retryDelayMs!="number"||t.retryDelayMs<0)&&(t.retryDelayMs=M.retryDelayMs),t}function Re(e={}){return se=ae(e),se}function Me(){return se}var N=class{constructor(){this.store=new Map}get(t){let n=this.store.get(t);if(n){if(n.expiresAt&&n.expiresAt<=Date.now()){this.store.delete(t);return}return n.value}}set(t,n,r){let o=typeof r=="number"&&r>0?Date.now()+r:void 0;this.store.set(t,{value:n,expiresAt:o})}delete(t){this.store.delete(t)}clear(){this.store.clear()}};var y=class extends Error{constructor(t,n,r){super(t),this.name="ResolverError",this.status=n,this.detail=r}},T=class extends Error{constructor(){super("Resolver request aborted"),this.name="ResolverAbortError"}};function Ct(e){return e.replace(/^data-/,"").split(/[-_:]/).filter(Boolean).map((t,n)=>n===0?t.toLowerCase():t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join("")}function xe(e){var n;if(typeof document=="undefined")return;let t=document.querySelector(`meta[name="${e}"]`);return(n=t==null?void 0:t.getAttribute("content"))!=null?n:void 0}function le(e,t){var o;if(!e)return;if(e.hasAttribute(t))return(o=e.getAttribute(t))!=null?o:void 0;let n=Ct(t),r=e.dataset[n];return r!=null?r:void 0}function Et(e,t){var n;if(e){if(e.startsWith("meta:"))return xe(e.slice(5));if(e.startsWith("data:"))return le(t,e.slice(5));if(e.startsWith("element:"))return le(t,e.slice(8));if(e.includes("=")){let[,r]=e.split("=");return r}return(n=le(t,e))!=null?n:xe(e)}}function Ae(e,t){var s,a;if(!e||e.strategy!=="header")return{};let n=(s=e.header)!=null?s:"Authorization",r=Et((a=e.source)!=null?a:"data-auth-token",t);if(!r)return{};let o=e.prefix?`${e.prefix.trim()} ${r}`.trim():r;return{[n]:o}}var we="[data-endpoint-url]",Se="data-relationship-hidden",Le="data-relationship-hidden-initialised",He="data-relationship-json-initialised",ke="data-relationship-json",_="data-relationship-submit-mode",Ie="data-relationship-original-name",Oe="data-relationship-error",Tt="[data-relationship-type]";function De(e=document){var r;let t=e instanceof Document?e:(r=e.ownerDocument)!=null?r:document,n=Array.from((e instanceof Document?e:t).querySelectorAll(we));return e instanceof HTMLElement&&e.matches(we)&&n.unshift(e),Array.from(new Set(n))}function Fe(e){let t={};for(let[n,r]of Object.entries(e.dataset))typeof r=="string"&&(t[n]=r);return t}function ce(e){return e instanceof HTMLSelectElement&&e.multiple}function Pe(e){e.getAttribute(_)!=="json"&&(e.hasAttribute(Le)||(e.setAttribute(Le,"true"),e.setAttribute(_,"hidden-array"),H(e),e.addEventListener("change",()=>H(e))))}function H(e){if(e.getAttribute(_)==="json"){x(e);return}let t=Ne(e);for(;t.firstChild;)t.removeChild(t.firstChild);let n=e.name||e.id;if(!n)return;let r=n.endsWith("[]")?n:`${n}[]`;Array.from(e.selectedOptions).forEach(o=>{let s=document.createElement("input");s.type="hidden",s.name=r,s.value=o.value,t.appendChild(s)})}function Ne(e){var r,o,s;let t=(r=e.parentElement)==null?void 0:r.querySelector(`[${Se}]`);if(t)return t;let n=document.createElement("div");return n.setAttribute(Se,"true"),n.style.display="none",e.parentElement?e.parentElement.appendChild(n):e.nextSibling?(o=e.parentNode)==null||o.insertBefore(n,e.nextSibling):(s=e.parentNode)==null||s.appendChild(n),n}function _e(e){if(e.hasAttribute(He))return;e.setAttribute(He,"true"),e.setAttribute(_,"json");let t=e.getAttribute("name");t&&(e.setAttribute(Ie,t),e.removeAttribute("name")),x(e),e.addEventListener("change",()=>x(e)),e.addEventListener("blur",()=>x(e))}function x(e){var s,a;let t=Ne(e),n=t.querySelector(`[${ke}]`);n||(n=document.createElement("input"),n.type="hidden",n.setAttribute(ke,"true"),t.appendChild(n));let r=(s=e.getAttribute(Ie))!=null?s:e.getAttribute("name");if(r){let i=r.endsWith("[]")?r.slice(0,r.length-2):r;n.name=i}let o=Array.from(e.selectedOptions).map(i=>i.value);if(e.multiple)n.value=JSON.stringify(o);else{let i=(a=o[0])!=null?a:"";n.value=i?JSON.stringify(i):"null"}}function de(e,t){var o,s;let n=(s=(o=e.closest(Tt))!=null?o:e.parentElement)!=null?s:e,r=n.querySelector(`[${Oe}]`);if(!t||t.trim()===""){r&&r.remove();return}r||(r=document.createElement("span"),r.setAttribute(Oe,"true"),r.className="formgen-error",r.setAttribute("role","alert"),n.appendChild(r)),r.textContent=t}function Ve(e){de(e,null)}function ue(e){if(!e)return null;if(e instanceof HTMLInputElement)return e.type==="checkbox"||e.type==="radio"?e.checked?e.value:null:e.value;if(e instanceof HTMLSelectElement){if(e.multiple)return Array.from(e.selectedOptions).map(n=>n.value);let t=e.selectedOptions[0];return t?t.value:null}return e instanceof HTMLTextAreaElement?e.value:e.textContent}var Rt=/\{\{\s*([^}]+)\s*\}\}/g,Mt="Unable to load options.";function V(){return typeof performance!="undefined"&&typeof performance.now=="function"?performance.now():Date.now()}function je(e){return new Promise(t=>{setTimeout(t,e)})}function xt(e,t){if(!e)return!1;if(e===t||e===`${t}[]`||e.endsWith(`[${t}]`)||e.endsWith(`[${t}][]`))return!0;let n=e.replace(/[^a-z0-9]/gi,"").toLowerCase(),r=t.replace(/[^a-z0-9]/gi,"").toLowerCase();return n.endsWith(r)}function Ge(e){if(e!=null)return Array.isArray(e)?e.length===0?void 0:e.join(","):e===""?void 0:e}function Ke(e){return!!e&&typeof e=="object"&&(e.name==="AbortError"||e instanceof T)}var A=class{constructor(t){this.abortController=null;this.element=t.element,this.field=t.field,this.endpoint=t.endpoint,this.config=t.config,this.cacheAdapter=t.cacheAdapter,this.cacheConfig=t.cacheConfig,this.dispatchEvent=t.dispatchEvent,this.renderers=t.renderers,this.defaultRenderer=t.defaultRenderer,this.customResolvers=t.customResolvers,this.element instanceof HTMLSelectElement&&(this.field.submitAs==="json"?_e(this.element):ce(this.element)&&Pe(this.element))}async resolve(){var l,u,c;this.cancelInFlight();let t=V(),n=await this.buildRequest(),r=!1,o;if(this.dispatchEvent(this.element,"loading",{element:this.element,field:this.field,endpoint:this.endpoint,request:n,response:null,fromCache:!1}),n.cacheKey&&this.cacheAdapter){let d=await this.cacheAdapter.get(n.cacheKey);Array.isArray(d)&&d.length>0&&(o=d,r=!0)}if(!o){let d=this.createContext(n,!1);for(let f of this.customResolvers)try{if(f.matches(d)){let p=await f.resolve(d);if(Array.isArray(p)){o=p;break}}}catch(p){throw this.handleError(p,n,null,t,0),p}}let s=null;try{o||(s=await this.fetchOptions(n,t),o=s.options,r=s.fromCache)}catch(d){return d instanceof T||Ke(d)?{options:[],fromCache:!1}:{options:[],fromCache:!1}}let a=this.createContext(n,r);this.config.transformOptions&&(o=await this.config.transformOptions(a,o)),await this.renderOptions(o,r),Ve(this.element);let i={element:this.element,field:this.field,endpoint:this.endpoint,request:n,response:(l=s==null?void 0:s.response)!=null?l:null,options:o,fromCache:r,durationMs:V()-t};return this.dispatchEvent(this.element,"success",i),n.cacheKey&&this.cacheAdapter&&!r&&await this.cacheAdapter.set(n.cacheKey,o,{ttlMs:this.cacheConfig.ttlMs,field:this.field,endpoint:this.endpoint}),s&&await((c=(u=this.config).afterFetch)==null?void 0:c.call(u,a,s)),this.element instanceof HTMLSelectElement?this.element.getAttribute("data-relationship-submit-mode")==="json"?x(this.element):this.element.multiple&&H(this.element):ce(this.element)&&H(this.element),this.abortController=null,{options:o,fromCache:r}}cancelInFlight(){this.abortController&&(this.abortController.abort(),this.abortController=null)}async fetchOptions(t,n){var u,c,d,f,p,g,h,E;let r=this.createContext(t,!1),o=(u=globalThis.fetch)==null?void 0:u.bind(globalThis);if(!o){let m=new y("Fetch API unavailable in current environment");throw this.handleError(m,t,null,n,0),m}let s=Math.max(0,(c=this.config.retryAttempts)!=null?c:0)+1,a=Math.max(0,(d=this.config.retryDelayMs)!=null?d:0),i=0,l=null;for(;i<s;){if((f=r.request.init.signal)!=null&&f.aborted)throw new T;await((g=(p=this.config).beforeFetch)==null?void 0:g.call(p,r));try{let m=await o(t.url,t.init);if(!m.ok){let pt=await Ue(m),ne=new y(`Resolver request failed with status ${m.status}`,m.status,pt);if(i<s-1&&At(m.status)){i+=1,l=ne,await je(a*i);continue}throw this.handleError(ne,t,m,n,i),ne}let b=await Ue(m),ut=this.extractOptions(b);return(E=(h=this.config.logger)==null?void 0:h.info)==null||E.call(h,"resolver:success",{field:this.field.name,url:t.url,status:m.status,durationMs:V()-n,attempt:i+1}),{response:m,payload:b,options:ut,fromCache:!1}}catch(m){if(Ke(m))throw new T;if(l=m,i<s-1){i+=1,await je(a*i);continue}let b=m instanceof y?m:new y(m instanceof Error?m.message:String(m!=null?m:"Unknown error"),void 0,m instanceof Error?{name:m.name,stack:m.stack}:void 0);throw this.handleError(b,t,null,n,i),b}}throw l instanceof y?l:new y("Resolver exhausted retries",void 0,l)}async buildRequest(){var u,c;let t=(this.endpoint.method||"GET").toUpperCase(),n=new URLSearchParams((u=this.endpoint.params)!=null?u:{});if(this.applyDynamicParams(n),this.field.mode==="search"){let d=this.getSearchValue();this.field.searchParam&&(d&&d.length>0?n.set(this.field.searchParam,d):n.delete(this.field.searchParam))}!this.endpoint.resultsPath&&!this.endpoint.mapping&&(Array.from(n.keys()).some(f=>f.toLowerCase()==="format")||n.set("format","options"));let r=this.normaliseBaseUrl((c=this.endpoint.url)!=null?c:""),o=n.toString(),s=o?`${r}?${o}`:r,a={Accept:"application/json"};Object.assign(a,Ae(this.endpoint.auth,this.element)),this.abortController=new AbortController;let i={url:s,cacheKey:this.computeCacheKey(t,s),init:{method:t,headers:a,signal:this.abortController.signal}},l=this.createContext(i,!1);if(this.config.buildHeaders){let d=await this.config.buildHeaders(l);d&&typeof d=="object"&&Object.assign(i.init.headers,d)}return i}applyDynamicParams(t){var r;let n=(r=this.endpoint.dynamicParams)!=null?r:{};Object.entries(n).forEach(([o,s])=>{let a=this.resolveDynamicTemplate(s);a==null||a===""?t.delete(o):t.set(o,a)})}resolveDynamicTemplate(t){if(!t)return;let n=!1,r=t.replace(Rt,(s,a)=>{var l,u;n=!0;let i=a.trim();if(!i)return"";if(i.startsWith("field:")){let c=i.slice(6);return(l=this.getFieldReferenceValue(c))!=null?l:""}return(i==="self"||i==="value")&&(u=this.getSelfValue())!=null?u:""});if(!n)return t;let o=r.trim();return o.length>0?o:void 0}getSelfValue(){if(this.field.mode==="search"){let n=this.getSearchValue();if(n!==void 0)return n===""?void 0:n}let t=ue(this.element);return Ge(t)}getSearchValue(){if(!(this.element instanceof HTMLElement))return;let t=this.element.getAttribute("data-endpoint-search-value");if(t!=null)return t;let n=this.element.dataset.endpointSearchValue;return n!=null?n:void 0}getFieldReferenceValue(t){let n=this.findDependencyElements(t);for(let r of n){let o=ue(r),s=Ge(o);if(s!==void 0)return s}}findDependencyElements(t){var a;let n=[],r=new Set,o=this.element.closest("form"),s=[];if(o){let i=Array.from(o.elements);for(let l of i)l instanceof HTMLElement&&s.push(l)}else{let i=(a=this.element.ownerDocument)!=null?a:document;s.push(...Array.from(i.querySelectorAll("[name], [data-field-name], [id]")))}for(let i of s){if(r.has(i))continue;let l=i.dataset.fieldName;if(l&&l===t){n.push(i),r.add(i);continue}let u=i.name;if(xt(u,t)){n.push(i),r.add(i);continue}let c=i.id;c&&c===t&&(n.push(i),r.add(i))}return n}normaliseBaseUrl(t){var o,s;if(/^https?:/i.test(t))return t;let n=(s=(o=this.config.baseUrl)==null?void 0:o.replace(/\/$/,""))!=null?s:"",r=t.startsWith("/")?t:`/${t}`;return`${n}${r}`||t}computeCacheKey(t,n){var r;return typeof this.field.cacheKey=="string"&&this.field.cacheKey.length>0?this.field.cacheKey:(r=this.config.cache)!=null&&r.keyFactory?this.config.cache.keyFactory(this.createContext({url:n,init:{method:t}},!1)):`${t.toUpperCase()}::${n}`}createContext(t,n){return{element:this.element,field:this.field,endpoint:this.endpoint,request:t,fromCache:n,config:this.config}}resolveRenderer(){var r,o;let t=(r=this.field.renderer)!=null?r:this.defaultRenderer,n=(o=this.renderers.get(t))!=null?o:this.renderers.get(this.defaultRenderer);if(!n)throw new y(`Renderer '${t}' is not registered`);return n}async renderOptions(t,n){let r=this.resolveRenderer(),o={element:this.element,field:this.field,options:t,fromCache:n,config:this.config};await r(o)}extractOptions(t){return this.unwrapPayload(t).map(r=>this.mapOption(r))}unwrapPayload(t){if(!this.endpoint.resultsPath){if(Array.isArray(t))return t;if(t&&typeof t=="object"&&"data"in t){let o=t.data;if(Array.isArray(o))return o}throw new y("Resolver response payload is not an array")}let n=this.endpoint.resultsPath.split(".").filter(Boolean),r=t;for(let o of n){if(r==null)break;r=r[o]}if(!Array.isArray(r))throw new y("Resolver resultsPath did not resolve to an array");return r}mapOption(t){var d,f,p,g,h,E,m;if(t==null)return{value:"",label:""};if(typeof t!="object"){let b=String(t);return{value:b,label:b,raw:t}}let n=(p=(f=(d=this.endpoint.mapping)==null?void 0:d.value)!=null?f:this.endpoint.valueField)!=null?p:"value",r=(E=(h=(g=this.endpoint.mapping)==null?void 0:g.label)!=null?h:this.endpoint.labelField)!=null?E:"label",o=(m=this.endpoint.mapping)==null?void 0:m.meta,s=typeof t=="object"&&t!==null?t:null,a=pe(t,n),i=pe(t,r),l=o?pe(t,o):void 0;a==null&&s&&(s.value!=null?a=s.value:s.id!=null&&(a=s.id)),i==null&&s&&(s.label!=null?i=s.label:s.name!=null&&(i=s.name));let u=a==null?"":String(a),c=i==null?u:String(i);return{value:u,label:c,meta:l,raw:t}}handleError(t,n,r,o,s){var l,u,c,d;let a=t instanceof y?t:new y(String(t||""));de(this.element,a.message||Mt);let i={element:this.element,field:this.field,endpoint:this.endpoint,request:n,response:r,error:a,fromCache:!1,durationMs:V()-o,attempt:s+1};(u=(l=this.config.logger)==null?void 0:l.error)==null||u.call(l,"resolver:error",{field:this.field.name,url:n.url,status:a.status,durationMs:i.durationMs,attempt:i.attempt,message:a.message}),(d=(c=this.config).onError)==null||d.call(c,this.createContext(n,!1),a),this.dispatchEvent(this.element,"error",i)}};async function Ue(e){let t=await e.text();if(!t)return null;try{return JSON.parse(t)}catch(n){throw new y("Resolver received invalid JSON",e.status,{error:n,body:t})}}function pe(e,t){if(!t)return;let n=t.split(".").filter(Boolean),r=e;for(let o of n){if(r==null)return;r=r[o]}return r}function At(e){return typeof e!="number"?!1:e>=500}var $e="default",he=class{constructor(){this.cache=new N}get(t){return this.cache.get(t)}set(t,n,r){this.cache.set(t,n,r.ttlMs)}delete(t){this.cache.delete(t)}clear(){this.cache.clear()}};function wt(e){let{element:t,options:n,field:r}=e;if(t instanceof HTMLSelectElement){let o=new Set(Array.from(t.selectedOptions).map(a=>a.value)),s=St(r,o);t.innerHTML="",n.forEach(a=>{let i=document.createElement("option");i.value=a.value,i.textContent=a.label,s.has(a.value)&&(i.selected=!0),t.appendChild(i)});return}if(t instanceof HTMLDataListElement){t.innerHTML="",n.forEach(o=>{let s=document.createElement("option");s.value=o.value,s.label=o.label,t.appendChild(s)});return}t.textContent=n.map(o=>o.label).join(", ")}function St(e,t){if(e.current==null)return t;let n=new Set;return Array.isArray(e.current)?e.current.forEach(r=>n.add(String(r))):n.add(String(e.current)),n}function fe(e,t){e.setAttribute("data-state",t)}var w=class{constructor(t){this.resolvers=new Map;this.renderers=new Map;this.customResolvers=[];this.dispatchEvent=(t,n,r)=>{var o;n==="loading"?fe(t,"loading"):n==="success"?fe(t,"ready"):n==="error"&&fe(t,"error");try{let s=new CustomEvent(`formgen:relationship:${n}`,{bubbles:!0,detail:r});t.dispatchEvent(s)}catch(s){(o=this.config.logger)!=null&&o.warn&&this.config.logger.warn("Failed to dispatch resolver event",s)}};var n;this.config=t?ae(t):Me(),t&&Re(this.config),this.cacheConfig=(n=this.config.cache)!=null?n:{},this.cacheAdapter=this.resolveCacheAdapter(this.cacheConfig),this.registerRenderer($e,wt)}resolveCacheAdapter(t){if(t.strategy!=="none")return t.strategy==="custom"?t.adapter:new he}getConfig(){return this.config}register(t,n){if(t instanceof HTMLElement)return this.attachField(t,n);this.registerResolver(t,n)}attachField(t,{field:n,endpoint:r}){let o=new A({element:t,field:n,endpoint:r,config:this.config,cacheAdapter:this.cacheAdapter,cacheConfig:this.cacheConfig,dispatchEvent:this.dispatchEvent,renderers:this.renderers,defaultRenderer:$e,customResolvers:this.customResolvers});return this.resolvers.set(t,o),o}get(t){return this.resolvers.get(t)}async resolve(t){let n=this.resolvers.get(t);n&&await n.resolve()}registerRenderer(t,n){this.renderers.set(t,n)}registerResolver(t,n){this.customResolvers.push({...n,name:t})}};function qe(e,t){if(!t||t<=0)return e;let n=0,r,o,s=(...i)=>{n=Date.now(),e(...i)};return(...i)=>{let l=Date.now(),u=t-(l-n);if(u<=0){r!==void 0&&(clearTimeout(r),r=void 0),s(...i);return}o=i,r===void 0&&(r=setTimeout(()=>{r=void 0,o&&(s(...o),o=void 0)},u))}}function Be(e,t){if(!t||t<=0)return e;let n;return(...o)=>{n!==void 0&&clearTimeout(n),n=setTimeout(()=>{n=void 0,e(...o)},t)}}function S(e){let{select:t,options:n,placeholder:r}=e,o=new Map(Array.from(t.options).filter(i=>i.value!=="").map(i=>[i.value,i.textContent||i.value])),s=new Set(Array.from(t.options).filter(i=>i.selected&&i.value!=="").map(i=>i.value));if(t.innerHTML="",r){let i=document.createElement("option");i.value="",i.textContent=r,t.appendChild(i)}let a=new Map(n.map(i=>[i.value,i]));for(let i of s)if(!a.has(i)){let l=o.get(i)||i;a.set(i,{value:i,label:l})}for(let i of a.values()){let l=document.createElement("option");l.value=i.value,l.textContent=i.label,l.selected=s.has(i.value),t.appendChild(l)}return t.dispatchEvent(new Event("change",{bubbles:!0})),K(t)}function j(e){var n,r;let t=Array.from(e.options).find(o=>o.value==="");return t&&t.textContent?t.textContent:e.getAttribute("placeholder")?(n=e.getAttribute("placeholder"))!=null?n:"":e.getAttribute("aria-label")?(r=e.getAttribute("aria-label"))!=null?r:"":"Select an option"}function G(e,t){var o,s,a,i;if(t)return t;let n=e.getAttribute("data-endpoint-search-placeholder");if(n)return n;let r=(i=(a=(s=(o=e.getAttribute("data-endpoint-field-label"))!=null?o:e.getAttribute("aria-label"))!=null?s:e.getAttribute("placeholder"))!=null?a:e.getAttribute("name"))!=null?i:e.id;return r?`Search ${r}`.trim():"Search options"}function K(e){return new Set(Array.from(e.options).filter(t=>t.selected&&t.value!=="").map(t=>t.value))}function U(e,t,n){let r=document.createDocumentFragment(),o=e.toLowerCase(),s=t.toLowerCase();if(!s)return r.append(document.createTextNode(e)),r;let a=0,i=o.indexOf(s),l=s.length;for(;i!==-1;){i>a&&r.append(document.createTextNode(e.slice(a,i)));let u=e.slice(i,i+l),c=document.createElement("mark");c.className=n,c.textContent=u,r.append(c),a=i+l,i=o.indexOf(s,a)}return a<e.length&&r.append(document.createTextNode(e.slice(a))),r}var ze=[],me=null;function $(e,t,n){ze.push({renderer:e,stores:t,onDestroy:n}),Lt()}function Lt(){me||typeof window=="undefined"||typeof document=="undefined"||(me=new MutationObserver(e=>{for(let t of e)t.removedNodes.forEach(n=>Ht(n))}),me.observe(document.documentElement,{childList:!0,subtree:!0}))}function Ht(e){if(e instanceof HTMLElement)for(let t of ze){let{renderer:n,stores:r,onDestroy:o}=t,s=kt(e,n);for(let a of s){let i=r.get(a);i&&(o(a,i),r.delete(a))}}}function kt(e,t){let n=new Set;return e instanceof HTMLSelectElement&&e.dataset.endpointRenderer===t&&n.add(e),e.querySelectorAll(`select[data-endpoint-renderer='${t}']`).forEach(r=>n.add(r)),Array.from(n)}var Ot={chips:{container:["relative","w-full","text-sm"],containerReady:["flex"],containerOpen:[],inner:["flex","w-full","items-stretch","gap-3","rounded-lg","border","border-gray-200","bg-white","py-3","ps-4","pe-9","transition","focus-within:border-blue-500","focus-within:ring-blue-500"],chips:["flex","flex-wrap","gap-2","grow","items-center"],chipsContent:["flex","flex-wrap","items-center","gap-2"],placeholder:["text-slate-500"],search:["flex","items-center","gap-2","grow"],searchInput:["w-full","min-w-[6rem]","border-none","bg-transparent","px-0","py-0","text-sm","placeholder:text-slate-400","focus:outline-none","focus:ring-0"],searchHighlight:["bg-amber-100","font-semibold"],chip:["inline-flex","items-center","gap-2","max-w-full","rounded-md","border","border-slate-200","bg-slate-100","px-3","py-1.5","text-sm","font-medium","text-slate-700","shadow-sm"],chipLabel:["truncate"],chipRemove:["flex","h-7","w-7","items-center","justify-center","rounded-full","text-lg","text-slate-400","transition","hover:text-slate-600","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","focus-visible:ring-offset-2"],actions:["flex","items-center","gap-1","ml-auto"],action:["inline-flex","h-9","w-9","items-center","justify-center","rounded-md","border","border-slate-200","bg-white","text-slate-500","shadow-sm","transition-colors","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","focus-visible:ring-offset-2"],actionClear:["hover:text-rose-500"],actionToggle:["text-base","text-slate-500"],menu:["absolute","left-0","right-0","z-20","mt-2","flex","flex-col","space-y-0.5","rounded-lg","border","border-gray-200","bg-white","p-1","shadow-xl","max-h-72","overflow-hidden","overflow-y-auto"],menuItem:["flex","justify-between","items-center","gap-2","rounded-lg","px-4","py-2","w-full","text-left","text-sm","text-gray-800","cursor-pointer","transition","hover:bg-gray-100","focus:outline-none","focus:bg-gray-100"],menuEmpty:["px-3","py-2","text-sm","text-slate-500"],nativeSelect:["hidden"]},typeahead:{container:["relative","w-full","text-sm"],containerReady:["block"],containerOpen:[],control:["flex","items-center","gap-x-2","rounded-lg","border","border-gray-200","bg-white","py-3","ps-4","pe-9","transition","focus-within:border-blue-500","focus-within:ring-blue-500"],input:["w-full","min-w-0","border-none","bg-transparent","px-0","py-0","text-sm","text-slate-900","placeholder:text-slate-400","focus:outline-none","focus:ring-0"],clear:["inline-flex","h-8","w-8","items-center","justify-center","rounded-md","text-slate-400","transition","hover:bg-slate-100","hover:text-slate-600","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-blue-500","focus-visible:ring-offset-2","disabled:cursor-default","disabled:opacity-40"],dropdown:["absolute","left-0","right-0","z-20","mt-2","flex","flex-col","space-y-0.5","rounded-lg","border","border-gray-200","bg-white","p-1","shadow-xl","max-h-72","overflow-hidden","overflow-y-auto"],option:["flex","justify-between","items-center","gap-2","rounded-lg","px-4","py-2","w-full","text-left","text-sm","text-gray-800","cursor-pointer","transition","hover:bg-gray-100","focus:outline-none","focus:bg-gray-100"],optionActive:["bg-slate-100"],highlight:["bg-amber-100","font-semibold"],empty:["px-3","py-2","text-sm","text-slate-500"],nativeSelect:["hidden"]}},q=Qe(Ot);function R(){return Qe(q)}function Je(e={}){return q={chips:We(q.chips,e.chips),typeahead:We(q.typeahead,e.typeahead)},R()}function v(e,t){if(!t||t.length===0){e.className="";return}e.className=t.join(" ")}function C(e,t){!t||t.length===0||e.classList.add(...t)}function k(e,t){!t||t.length===0||e.classList.remove(...t)}function z(e){return!e||e.length===0?"":e.join(" ")}function ge(...e){let t=[],n=new Set;for(let r of e)if(r)for(let o of r)n.has(o)||(n.add(o),t.push(o));return t}function Qe(e){return{chips:B(e.chips),typeahead:B(e.typeahead)}}function B(e){let t={};return Object.keys(e).forEach(n=>{t[n]=[...e[n]]}),t}function We(e,t){if(!t)return B(e);let n=B(e);return Object.keys(t).forEach(r=>{let o=t[r];o!==void 0&&(n[r]=It(o))}),n}function It(e){return(Array.isArray(e)?e:[e]).flatMap(n=>n.split(/\s+/)).map(n=>n.trim()).filter(Boolean)}var Dt="data-fg-chip-root",Ft="data-fg-chip-value",ve=new WeakMap;function Ye(e){e.registerRenderer("chips",Pt)}function Ze(e){if(!e.multiple)return;let t=Xe(e),n=S({select:t.select,options:t.options,placeholder:t.placeholder});ye(t,n),W(t,n),Ce(t,n)}var Pt=e=>{let{element:t,options:n}=e;if(!(t instanceof HTMLSelectElement)||!t.multiple)return;let r=Xe(t);r.options=n;let o=S({select:r.select,options:n,placeholder:r.placeholder});ye(r,o),W(r,o),r.isOpen||O(r,!1),Ce(r,o)};function Xe(e){let t=ve.get(e);if(t)return t;let n=R().chips,r=document.createElement("div");v(r,n.container),r.style.width="100%",r.setAttribute(Dt,"true"),r.hidden=!0;let o=document.createElement("div");v(o,n.chips);let s=document.createElement("div");v(s,n.chipsContent),o.appendChild(s);let a=document.createElement("div");v(a,n.actions);let i=document.createElement("button");i.type="button",v(i,ge(n.action,n.actionClear)),i.setAttribute("aria-label","Clear selection"),i.innerHTML='<span aria-hidden="true">&times;</span>';let l=document.createElement("button");l.type="button",v(l,ge(n.action,n.actionToggle)),l.setAttribute("aria-haspopup","listbox"),l.setAttribute("aria-expanded","false"),l.innerHTML='<svg class="shrink-0 size-3.5 text-gray-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m7 15 5 5 5-5"/><path d="m7 9 5-5 5 5"/></svg>',a.append(i,l);let u=document.createElement("div");v(u,n.inner),u.append(o,a);let c=document.createElement("div");v(c,n.menu),c.hidden=!0,r.append(u,c),e.insertAdjacentElement("beforebegin",r),C(e,n.nativeSelect);let d=j(e),f=e.dataset.endpointMode==="search",p={select:e,container:r,chips:o,chipsContent:s,menu:c,toggle:l,clear:i,placeholder:d,options:[],documentHandler:()=>{},isOpen:!1,searchMode:f,searchValue:"",theme:n};if(f){let g=document.createElement("div");v(g,n.search);let h=document.createElement("input");h.type="search",v(h,n.searchInput),h.setAttribute("placeholder",G(e)),h.setAttribute("autocomplete","off"),h.setAttribute("aria-label","Search options"),g.appendChild(h),o.appendChild(g),p.searchInput=h,p.searchValue="",e.setAttribute("data-endpoint-search-value","");let E=()=>{let m=h.value.trim();p.searchValue=m,e.setAttribute("data-endpoint-search-value",m);let b=K(e);W(p,b),e.dispatchEvent(new Event("input",{bubbles:!0}))};h.addEventListener("input",()=>E()),h.addEventListener("focus",()=>{let m=p.searchValue.trim().length>0,b=p.options.length>0;(m||b)&&O(p,!0)}),o.addEventListener("click",()=>{h.focus()})}return p.documentHandler=g=>{r.contains(g.target)||O(p,!1)},i.addEventListener("click",()=>{be(p,new Set)}),l.addEventListener("click",g=>{g.preventDefault(),O(p,c.hidden)}),document.addEventListener("click",p.documentHandler),ve.set(e,p),typeof requestAnimationFrame=="function"?requestAnimationFrame(()=>{r.hidden=!1,C(r,n.containerReady)}):(r.hidden=!1,C(r,n.containerReady)),p}function ye(e,t){var u;let{chipsContent:n,chips:r,select:o,placeholder:s,searchInput:a,theme:i}=e;if(a&&document.activeElement===a)return;n.innerHTML="";let l=Array.from(o.options).filter(c=>c.selected&&c.value!=="");if(l.length===0){let c=document.createElement("span");v(c,i.placeholder),c.textContent=s||"Select an option",n.appendChild(c)}else for(let c of l){let d=c.value,f=(u=c.textContent)!=null?u:d,p=document.createElement("span");v(p,i.chip),p.setAttribute(Ft,d);let g=document.createElement("span");v(g,i.chipLabel),g.textContent=f;let h=document.createElement("button");h.type="button",v(h,i.chipRemove),h.setAttribute("aria-label",`Remove ${f}`),h.innerHTML="&times;",h.addEventListener("click",()=>{let E=new Set(t);E.delete(d),be(e,E)}),p.append(g,h),n.appendChild(p)}if(e.searchMode&&a&&a.parentElement){let c=a.parentElement;c.parentElement!==r&&r.appendChild(c)}}function W(e,t){var u;let{menu:n,options:r,searchMode:o,searchValue:s,theme:a}=e;n.innerHTML="",n.setAttribute("role","listbox");let i=o?s.trim().toLowerCase():"",l=r.filter(c=>!t.has(c.value)).filter(c=>{var f;return i?((f=c.label)!=null?f:c.value).toLowerCase().includes(i)||c.value.toLowerCase().includes(i):!0});if(l.length===0){let c=document.createElement("div");v(c,a.menuEmpty),c.textContent=i?"No matches":"No more options",n.appendChild(c);return}for(let c of l){let d=document.createElement("button");d.type="button",v(d,a.menuItem),d.setAttribute("role","option"),d.dataset.value=c.value;let f=document.createElement("span"),p=(u=c.label)!=null?u:c.value;if(f.appendChild(U(p,i,z(a.searchHighlight))),d.appendChild(f),t.has(c.value)){d.setAttribute("aria-selected","true");let h=document.createElement("span");h.innerHTML='<svg class="shrink-0 size-3.5 text-blue-600" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>',d.appendChild(h)}d.addEventListener("click",()=>{let h=new Set(t);h.add(c.value),be(e,h),O(e,!1)}),n.appendChild(d)}}function be(e,t){let{select:n}=e;for(let o of Array.from(n.options))o.selected=t.has(o.value);n.dispatchEvent(new Event("change",{bubbles:!0}));let r=K(n);ye(e,r),e.searchMode&&(e.searchInput&&(e.searchInput.value=""),e.searchValue="",n.setAttribute("data-endpoint-search-value","")),W(e,r),Ce(e,r),e.searchMode&&n.dispatchEvent(new Event("input",{bubbles:!0}))}function Ce(e,t){e.clear.disabled=t.size===0}function O(e,t){e.menu.hidden=!t,e.toggle.setAttribute("aria-expanded",t?"true":"false"),t?(C(e.container,e.theme.containerOpen),e.searchMode&&e.searchInput&&e.searchInput.focus()):k(e.container,e.theme.containerOpen),e.isOpen=t}function Nt(e){document.removeEventListener("click",e.documentHandler)}$("chips",ve,(e,t)=>{Nt(t)});var _t="data-fg-typeahead-root",tt="data-fg-typeahead-option",Ee=new WeakMap;function nt(e){e.registerRenderer("typeahead",Vt)}function rt(e){if(e.multiple)return;let t=ot(e),n=S({select:t.select,options:t.options,placeholder:t.placeholder});it(t,n),D(t)}var Vt=e=>{let{element:t,options:n}=e;if(!(t instanceof HTMLSelectElement)||t.multiple)return;let r=ot(t);r.options=n;let o=S({select:r.select,options:n,placeholder:r.placeholder});it(r,o),D(r)};function ot(e){let t=Ee.get(e);if(t)return t;let n=R().typeahead,r=document.createElement("div");v(r,n.container),r.setAttribute(_t,"true"),r.hidden=!0;let o=document.createElement("div");v(o,n.control),o.setAttribute("role","combobox"),o.setAttribute("aria-haspopup","listbox"),o.setAttribute("aria-expanded","false");let s=document.createElement("input");s.type="text",v(s,n.input),s.autocomplete="off",s.setAttribute("aria-autocomplete","list");let a=document.createElement("button");a.type="button",v(a,n.clear),a.setAttribute("aria-label","Clear selection"),a.innerHTML='<span aria-hidden="true">&times;</span>',a.disabled=!0,o.append(s,a);let i=document.createElement("div");v(i,n.dropdown),i.setAttribute("role","listbox"),i.hidden=!0;let l=e.id?`${e.id}__typeahead`:`fg-typeahead-${Math.random().toString(36).slice(2)}`;i.id=l,o.setAttribute("aria-controls",l),s.setAttribute("aria-controls",l);let u=document.createElement("div");u.className="absolute top-1/2 end-3 -translate-y-1/2 pointer-events-none",u.innerHTML='<svg class="shrink-0 size-3.5 text-gray-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m7 15 5 5 5-5"/><path d="m7 9 5-5 5 5"/></svg>',r.append(o,u,i),e.insertAdjacentElement("beforebegin",r),C(e,n.nativeSelect);let c=e.dataset.endpointPlaceholder||j(e),d=G(e,e.dataset.endpointSearchPlaceholder),f=e.dataset.endpointFieldLabel||e.getAttribute("aria-label")||e.getAttribute("name")||e.id||void 0;s.placeholder=c,s.setAttribute("aria-label",f!=null?f:"Related record");let p={select:e,container:r,control:o,input:s,clear:a,dropdown:i,options:[],filtered:[],placeholder:c,searchPlaceholder:d,label:f,highlightedIndex:-1,isOpen:!1,searchMode:e.dataset.endpointMode==="search",searchQuery:"",documentHandler:()=>{},theme:n};return s.placeholder=p.searchMode?p.searchPlaceholder:p.placeholder,jt(p),Ee.set(e,p),F(p),typeof requestAnimationFrame=="function"?requestAnimationFrame(()=>{r.hidden=!1,C(r,n.containerReady)}):(r.hidden=!1,C(r,n.containerReady)),p}function jt(e){let{input:t,clear:n,dropdown:r}=e;t.addEventListener("focus",()=>{I(e),t.placeholder=e.searchMode?e.searchPlaceholder:e.placeholder}),t.addEventListener("click",()=>{I(e)}),t.addEventListener("input",()=>Gt(e)),t.addEventListener("keydown",o=>Kt(e,o)),n.addEventListener("click",()=>{Ut(e)}),r.addEventListener("mousedown",o=>{o.preventDefault()}),e.documentHandler=o=>{e.container.contains(o.target)||(Q(e),L(e))},document.addEventListener("click",e.documentHandler)}function it(e,t){var i,l;let{select:n,input:r}=e,o=t.size>0;if(document.activeElement===r&&e.searchQuery&&!o)return;let s=(i=Array.from(t)[0])!=null?i:"";e.highlightedIndex=-1;let a=s?Array.from(n.options).find(u=>u.value===s):void 0;r.value=(l=a==null?void 0:a.textContent)!=null?l:"",s||L(e),F(e)}function Gt(e){let{input:t,select:n}=e,r=t.value.trim();e.highlightedIndex=-1,e.searchQuery=r,n.setAttribute("data-endpoint-search-value",r),D(e),I(e),e.searchMode&&n.dispatchEvent(new Event("input",{bubbles:!0})),F(e)}function Kt(e,t){if(!new Set(["ArrowDown","ArrowUp","Enter","Escape","Tab"]).has(t.key))return;let{filtered:r}=e;if(t.key==="Escape"){Q(e),L(e);return}if(t.key==="Tab"){if(e.isOpen&&e.highlightedIndex>=0){let o=r[e.highlightedIndex];o&&(t.preventDefault(),J(e,o))}Q(e),L(e);return}if(t.preventDefault(),t.key==="ArrowDown"){e.isOpen||I(e),et(e,1);return}if(t.key==="ArrowUp"){e.isOpen||I(e),et(e,-1);return}if(t.key==="Enter")if(e.highlightedIndex>=0){let o=r[e.highlightedIndex];o&&J(e,o)}else r.length===1&&J(e,r[0])}function et(e,t){let{filtered:n}=e;if(n.length===0){e.highlightedIndex=-1;return}let r=e.highlightedIndex===-1?t>0?0:n.length-1:(e.highlightedIndex+t+n.length)%n.length;e.highlightedIndex=r,Y(e)}function J(e,t){var o;let{select:n,input:r}=e;for(let s of Array.from(n.options))s.selected=s.value===t.value;r.value=(o=t.label)!=null?o:t.value,L(e),n.dispatchEvent(new Event("change",{bubbles:!0})),Q(e),e.highlightedIndex=-1,e.searchQuery="",n.setAttribute("data-endpoint-search-value",""),F(e)}function Ut(e){let{select:t,input:n}=e;for(let r of Array.from(t.options))r.selected=!1;n.value="",L(e),t.dispatchEvent(new Event("change",{bubbles:!0})),e.highlightedIndex=-1,e.searchQuery="",t.setAttribute("data-endpoint-search-value",""),D(e),F(e),e.searchMode&&t.dispatchEvent(new Event("input",{bubbles:!0}))}function I(e){if(!e.isOpen){if(e.input.placeholder=e.searchMode?e.searchPlaceholder:e.placeholder,D(e),e.searchMode&&e.filtered.length===0&&!e.searchQuery){e.dropdown.hidden=!0,e.control.setAttribute("aria-expanded","false");return}e.dropdown.hidden=!1,e.control.setAttribute("aria-expanded","true"),C(e.container,e.theme.containerOpen),e.isOpen=!0,e.highlightedIndex===-1&&e.filtered.length>0&&(e.highlightedIndex=0),Y(e)}}function Q(e){e.isOpen&&(e.dropdown.hidden=!0,e.control.setAttribute("aria-expanded","false"),k(e.container,e.theme.containerOpen),e.isOpen=!1,e.highlightedIndex=-1,Y(e))}function D(e){var i;let{dropdown:t,select:n,theme:r}=e;t.innerHTML="";let o=e.searchQuery.trim().toLowerCase(),s=e.options;if(o&&(s=s.filter(l=>{var c;return((c=l.label)!=null?c:l.value).toLowerCase().includes(o)||l.value.toLowerCase().includes(o)})),e.filtered=s,s.length===0){let l=document.createElement("div");v(l,r.empty),l.textContent=o?"No matches":"No options",t.appendChild(l);return}let a=(i=Array.from(n.options).find(l=>l.selected))==null?void 0:i.value;s.forEach((l,u)=>{var f;let c=document.createElement("button");c.type="button",v(c,r.option),c.setAttribute("role","option"),c.dataset.value=l.value,c.setAttribute(tt,"true"),c.dataset.selected=l.value===a?"true":"false";let d=document.createElement("span");if(d.appendChild(U((f=l.label)!=null?f:l.value,o,z(r.highlight))),c.appendChild(d),l.value===a){c.setAttribute("aria-selected","true");let p=document.createElement("span");p.innerHTML='<svg class="shrink-0 size-3.5 text-blue-600" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>',c.appendChild(p)}c.addEventListener("click",()=>J(e,l)),t.appendChild(c),e.highlightedIndex===-1&&l.value===a&&(e.highlightedIndex=u)}),Y(e)}function Y(e){let{dropdown:t,highlightedIndex:n,theme:r}=e;Array.from(t.querySelectorAll(`[${tt}]`)).forEach((s,a)=>{let i=a===n;i?C(s,r.optionActive):k(s,r.optionActive),s.setAttribute("aria-selected",i||s.dataset.selected==="true"?"true":"false"),i&&typeof s.scrollIntoView=="function"&&s.scrollIntoView({block:"nearest"})})}function F(e){let{input:t,select:n,clear:r}=e,o=t.value.trim()!=="",s=Array.from(n.options).some(a=>a.selected&&a.value!=="");r.disabled=!(o||s)}function L(e){e.input.value||(e.input.placeholder=e.searchMode?e.searchPlaceholder:e.placeholder)}function $t(e){document.removeEventListener("click",e.documentHandler)}$("typeahead",Ee,(e,t)=>{$t(t)});var P=new Map,Z=new WeakMap;ct();function st(e,t){let n=lt(e);!n||typeof t!="function"||P.set(n,t)}function X(e=document){var n;let t=qt(e);for(let r of t){let o=lt((n=r.dataset.component)!=null?n:"");if(!o)continue;let s=Z.get(r);if(s&&s.name===o)continue;s!=null&&s.teardown&&(s.teardown(),Z.delete(r));let a=P.get(o);if(!a)continue;let i=Bt(r.getAttribute("data-component-config")),l=zt(r,e),u=a({element:r,config:i,root:l});Z.set(r,{name:o,teardown:typeof u=="function"?u:void 0})}}function at(){P.clear(),Z=new WeakMap,ct()}function qt(e){let t=(e instanceof Document,e),n=Array.from(t.querySelectorAll("[data-component]"));return e instanceof HTMLElement&&e.hasAttribute("data-component")&&n.unshift(e),n}function Bt(e){if(e)try{let t=JSON.parse(e);return typeof t=="object"&&t!==null?t:void 0}catch(t){console.warn("formgen: failed to parse component config",t);return}}function zt(e,t){var r,o,s;let n=e.closest("[data-formgen-auto-init]");return n||(t instanceof HTMLElement?t:(s=(o=t.body)!=null?o:(r=e.ownerDocument)==null?void 0:r.body)!=null?s:e)}function lt(e){return e.trim().toLowerCase()}function ct(){P.has("datetime-range")||P.set("datetime-range",Wt)}function Wt({element:e}){let t=Array.from(e.querySelectorAll("input[type='datetime-local'], input[type='date'], input[type='time']"));if(t.length<2)return;let[n,r]=t,o=()=>{n.value&&(!r.value||r.value<n.value)&&(r.value=n.value)},s=()=>{n.removeEventListener("change",o),r.removeEventListener("change",o)};return n.addEventListener("change",o),r.addEventListener("change",o),o(),s}var te=null;async function Jt(e={}){let t=Object.keys(e!=null?e:{}).length>0,n=te&&!t?te:null,r=n!=null?n:new w(t?e:void 0);n||(te=r,globalThis.formgenRelationships=r),Ye(r),nt(r);let o=Array.from(document.querySelectorAll("[data-formgen-auto-init]")),s=[];for(let a of o){X(a);let i=De(a);for(let l of i){let u=Fe(l),c=Yt(u),d=Zt(l,u);r.get(l)||r.register(l,{field:d,endpoint:c}),d.renderer==="chips"&&l instanceof HTMLSelectElement&&l.multiple&&Ze(l),d.renderer==="typeahead"&&l instanceof HTMLSelectElement&&!l.multiple&&rt(l),nn(l,d,a,r),rn(l,d,a,r),on(l,d,r),tn(d)&&s.push(r.resolve(l))}}return s.length>0&&await Promise.all(s),r}function Qt(){te=null,delete globalThis.formgenRelationships}function Yt(e){let t={};e.endpointUrl&&(t.url=e.endpointUrl),e.endpointMethod&&(t.method=e.endpointMethod.toUpperCase()),e.endpointLabelField&&(t.labelField=e.endpointLabelField),e.endpointValueField&&(t.valueField=e.endpointValueField),e.endpointResultsPath&&(t.resultsPath=e.endpointResultsPath),e.endpointMode&&(t.mode=e.endpointMode),e.endpointSearchParam&&(t.searchParam=e.endpointSearchParam),e.endpointSubmitAs&&(t.submitAs=e.endpointSubmitAs);let n=ee(e,"endpointParams");n&&(t.params=n);let r=ee(e,"endpointDynamicParams");r&&(t.dynamicParams=r);let o=ee(e,"endpointMapping");o&&(o.value||o.label)&&(t.mapping=o);let s=ee(e,"endpointAuth");return s&&(s.source||s.header||s.strategy)&&(t.auth=s),t}function Zt(e,t){var r,o;let n={name:(o=(r=e.getAttribute("name"))!=null?r:e.getAttribute("id"))!=null?o:void 0};return t.relationshipType&&(n.relationship=t.relationshipType),t.relationshipCardinality&&(n.cardinality=t.relationshipCardinality),t.endpointSubmitAs==="json"?n.submitAs="json":t.endpointSubmitAs&&(n.submitAs="default"),t.endpointCacheKey&&(n.cacheKey=t.endpointCacheKey),t.endpointRenderer&&(n.renderer=t.endpointRenderer),t.endpointRefresh&&(n.refreshMode=t.endpointRefresh==="manual"?"manual":"auto"),t.endpointRefreshOn&&(n.refreshOn=t.endpointRefreshOn.split(",").map(s=>s.trim()).filter(Boolean)),t.endpointMode==="search"&&(n.mode="search"),t.endpointThrottle&&(n.throttleMs=dt(t.endpointThrottle)),t.endpointDebounce&&(n.debounceMs=dt(t.endpointDebounce)),t.endpointSearchParam&&(n.searchParam=t.endpointSearchParam),t.relationshipCurrent&&(n.current=Xt(t.relationshipCurrent)),n.refreshMode||(n.refreshMode="auto"),n.mode||(n.mode="default"),n}function Xt(e){let t=e.trim();if(!t)return null;try{let n=JSON.parse(t);return Array.isArray(n)?n.map(r=>String(r)):n==null?null:String(n)}catch{return t.includes(",")?t.split(",").map(r=>r.trim()).filter(Boolean):t}}function ee(e,t){let n={},r=t.toLowerCase();return Object.entries(e).forEach(([o,s])=>{if(!s)return;if(o===t||o.toLowerCase()===r){n[""]=s;return}if(!o.startsWith(t))return;let a=o.slice(t.length);if(!a)return;let i=en(a);i&&(n[i]=s)}),Object.keys(n).length>0?n:void 0}function en(e){let t=e.trim();if(!t)return"";let n=t.split(""),r=[];return n.forEach((o,s)=>{/[A-Z]/.test(o)?(s!==0&&r.push("-"),r.push(o.toLowerCase())):r.push(o)}),r.join("").replace(/^-+/,"")}function tn(e){return!(e.refreshMode==="manual"||e.mode==="search")}function nn(e,t,n,r){var i,l;if(!t.refreshOn||t.refreshOn.length===0||t.refreshMode==="manual"||e.dataset.relationshipRefreshBound==="true")return;e.dataset.relationshipRefreshBound="true";let o=e.closest("form"),s=(l=(i=o!=null?o:n)!=null?i:e.ownerDocument)!=null?l:document,a=()=>{r.resolve(e).catch(()=>{})};t.refreshOn.forEach(u=>{sn(s,u).forEach(d=>{let f=d instanceof HTMLInputElement&&d.type==="text"?"input":"change";d.addEventListener(f,a)})})}function rn(e,t,n,r){var c,d,f,p;if(t.refreshMode!=="manual"||e.dataset.relationshipManualBound==="true")return;e.dataset.relationshipManualBound="true";let o=(c=t.name)!=null?c:e.getAttribute("id");if(!o)return;let s=ln(o),a=(f=(d=n.ownerDocument)!=null?d:e.ownerDocument)!=null?f:document,i=new Set;[`[data-endpoint-refresh-target="${s}"]`,`[data-endpoint-refresh-for="${s}"]`].forEach(g=>{a.querySelectorAll(g).forEach(h=>i.add(h))});let u=(p=e.closest("[data-relationship-type]"))!=null?p:e.parentElement;u==null||u.querySelectorAll("[data-endpoint-refresh-trigger]").forEach(g=>i.add(g)),i.forEach(g=>{g.dataset.relationshipRefreshListener!=="true"&&(g.dataset.relationshipRefreshListener="true",g.addEventListener("click",h=>{h.preventDefault(),r.resolve(e).catch(()=>{})}))})}function on(e,t,n){var c,d;if(t.mode!=="search"||e.dataset.relationshipSearchBound==="true")return;e.dataset.relationshipSearchBound="true";let r=n.getConfig(),o=(c=t.throttleMs)!=null?c:r.searchThrottleMs,s=(d=t.debounceMs)!=null?d:r.searchDebounceMs,a=()=>{n.resolve(e).catch(()=>{})},i=()=>a();s>0&&(i=Be(i,s)),o>0&&(i=qe(i,o));let l=()=>{if(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement){let f=e.value.trim();e.setAttribute("data-endpoint-search-value",f)}},u=()=>{l(),i()};e.addEventListener("input",u),(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)&&e.addEventListener("change",u)}function sn(e,t){var i;let n=[],r=new Set,o=e instanceof HTMLFormElement?e:e instanceof HTMLElement?e.closest("form"):null,s=e instanceof Document?e:(i=e.ownerDocument)!=null?i:document,a=[];return o?Array.from(o.elements).forEach(u=>{u instanceof HTMLElement&&a.push(u)}):a.push(...Array.from(s.querySelectorAll("[name], [data-field-name], [id]"))),a.forEach(l=>{if(r.has(l))return;let u=l.dataset.fieldName;if(u&&u===t){n.push(l),r.add(l);return}let c=l.name;if(an(c,t)){n.push(l),r.add(l);return}let d=l.id;d&&d===t&&(n.push(l),r.add(l))}),n}function an(e,t){if(!e)return!1;if(e===t||e===`${t}[]`||e.endsWith(`[${t}]`)||e.endsWith(`[${t}][]`))return!0;let n=e.replace(/[^a-z0-9]/gi,"").toLowerCase(),r=t.replace(/[^a-z0-9]/gi,"").toLowerCase();return n.endsWith(r)}function ln(e){return typeof CSS!="undefined"&&typeof CSS.escape=="function"?CSS.escape(e):e.replace(/(["\\])/g,"\\$1")}function dt(e){if(!e)return;let t=Number(e);return Number.isFinite(t)?t:void 0}return yt(cn);})();
//# sourceMappingURL=formgen-relationships.min.js.map
