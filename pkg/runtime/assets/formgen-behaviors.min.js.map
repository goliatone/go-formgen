{
  "version": 3,
  "sources": ["../../src/behaviors/index.ts", "../../src/behaviors/utils.ts", "../../src/behaviors/auto-slug.ts", "../../src/behaviors/registry.ts"],
  "sourcesContent": ["import { autoSlug } from \"./auto-slug\";\nimport { initBehaviors, registerBehavior, resetBehaviorRegistry } from \"./registry\";\nimport { slugify } from \"./utils\";\n\nregisterDefaults();\n\nfunction registerDefaults(): void {\n  registerBehavior(\"autoSlug\", autoSlug);\n}\n\nexport { initBehaviors, registerBehavior, slugify, autoSlug };\nexport type { BehaviorContext, BehaviorFactory } from \"./types\";\nexport type { BehaviorInitResult } from \"./registry\";\n\nexport function __resetBehaviorsForTests(): void {\n  resetBehaviorRegistry();\n  registerDefaults();\n}\n", "export function slugify(input: string): string {\n  if (!input) {\n    return \"\";\n  }\n  return input\n    .normalize(\"NFKD\")\n    .replace(/[\\u0300-\\u036f]/g, \"\")\n    .replace(/[^a-zA-Z0-9\\s-]/g, \" \")\n    .trim()\n    .replace(/[\\s_-]+/g, \"-\")\n    .replace(/^-+|-+$/g, \"\")\n    .toLowerCase();\n}\n\nexport function normalizeBehaviorName(name: string): string {\n  return name?.trim().toLowerCase() ?? \"\";\n}\n\nexport function collectBehaviorElements(root: Document | HTMLElement): HTMLElement[] {\n  const scope = root instanceof Document ? root : root;\n  const elements = Array.from(scope.querySelectorAll<HTMLElement>(\"[data-behavior]\"));\n  if (root instanceof HTMLElement && root.hasAttribute(\"data-behavior\")) {\n    elements.unshift(root);\n  }\n  return elements;\n}\n\nexport function parseBehaviorNames(raw: string | null): string[] {\n  if (!raw) {\n    return [];\n  }\n  const tokens = raw\n    .split(/[\\s,]+/)\n    .map((token) => normalizeBehaviorName(token))\n    .filter(Boolean);\n  return Array.from(new Set(tokens));\n}\n\nexport function parseBehaviorConfig(raw: string | null): unknown {\n  if (!raw) {\n    return undefined;\n  }\n  try {\n    return JSON.parse(raw);\n  } catch (error) {\n    console.warn(\"[formgen:behaviors] failed to parse data-behavior-config:\", error);\n    return undefined;\n  }\n}\n\nexport function selectBehaviorConfig(parsed: unknown, name: string, total: number): unknown {\n  if (parsed && typeof parsed === \"object\" && parsed !== null) {\n    const record = parsed as Record<string, unknown>;\n    if (Object.prototype.hasOwnProperty.call(record, name)) {\n      return record[name];\n    }\n    if (total === 1) {\n      return parsed;\n    }\n    return undefined;\n  }\n  if (total === 1) {\n    return parsed;\n  }\n  return undefined;\n}\n\nexport function resolveRootElement(element: HTMLElement, scope: Document | HTMLElement): HTMLElement {\n  const nearest = element.closest<HTMLElement>(\"[data-formgen-auto-init]\");\n  if (nearest) {\n    return nearest;\n  }\n  if (scope instanceof HTMLElement) {\n    return scope;\n  }\n  return scope.body ?? element.ownerDocument?.body ?? element;\n}\n\nexport function isInputControl(\n  node: Element | null,\n): node is HTMLInputElement | HTMLTextAreaElement {\n  return (\n    !!node &&\n    (node instanceof HTMLInputElement || node instanceof HTMLTextAreaElement)\n  );\n}\n\nexport function findNearestInput(element: HTMLElement): HTMLInputElement | HTMLTextAreaElement | null {\n  if (isInputControl(element)) {\n    return element;\n  }\n  return element.querySelector<HTMLInputElement | HTMLTextAreaElement>(\"input, textarea\");\n}\n\nexport function findFieldInput(\n  root: HTMLElement,\n  key: string,\n): HTMLInputElement | HTMLTextAreaElement | null {\n  if (!key) {\n    return null;\n  }\n  const attrSelector = `[name=\"${key}\"]`;\n  const idSelector = `#${buildElementID(key)}`;\n  return (\n    root.querySelector<HTMLInputElement | HTMLTextAreaElement>(attrSelector) ??\n    root.querySelector<HTMLInputElement | HTMLTextAreaElement>(idSelector)\n  );\n}\n\nexport function buildElementID(key: string): string {\n  const escaped = key.replace(/[^a-zA-Z0-9_-]/g, \"-\");\n  return escaped.startsWith(\"fg-\") ? escaped : `fg-${escaped}`;\n}\n", "import type { BehaviorFactory } from \"./types\";\nimport { findFieldInput, findNearestInput, slugify } from \"./utils\";\n\ninterface AutoSlugConfig {\n  source?: string;\n}\n\nexport const autoSlug: BehaviorFactory = ({ element, config, root }) => {\n  const target = findNearestInput(element);\n  if (!target) {\n    console.warn(\"[formgen:behaviors] autoSlug requires an input or textarea target.\");\n    return;\n  }\n\n  const options = normaliseConfig(config);\n  if (!options.source) {\n    console.warn(\"[formgen:behaviors] autoSlug config must define a source field.\");\n    return;\n  }\n\n  const source = findFieldInput(root, options.source);\n  if (!source) {\n    console.warn(`[formgen:behaviors] source field \"${options.source}\" not found for autoSlug.`);\n    return;\n  }\n\n  let syncing = false;\n  let manual = element.getAttribute(\"data-behavior-state\") === \"manual\";\n\n  if (!manual && target.value.trim().length > 0) {\n    manual = true;\n    element.setAttribute(\"data-behavior-state\", \"manual\");\n  }\n\n  const updateSlug = () => {\n    if (manual) {\n      return;\n    }\n    const nextValue = slugify(source.value || \"\");\n    if (nextValue === target.value) {\n      return;\n    }\n    syncing = true;\n    target.value = nextValue;\n    target.dispatchEvent(new Event(\"input\", { bubbles: true }));\n    syncing = false;\n  };\n\n  const handleSourceInput = () => {\n    updateSlug();\n  };\n\n  const handleTargetInput = (event: Event) => {\n    if (syncing) {\n      return;\n    }\n    const trimmed = target.value.trim();\n    if (trimmed.length === 0) {\n      manual = false;\n      element.removeAttribute(\"data-behavior-state\");\n      updateSlug();\n      return;\n    }\n    manual = true;\n    element.setAttribute(\"data-behavior-state\", \"manual\");\n  };\n\n  source.addEventListener(\"input\", handleSourceInput);\n  target.addEventListener(\"input\", handleTargetInput);\n\n  updateSlug();\n\n  return () => {\n    source.removeEventListener(\"input\", handleSourceInput);\n    target.removeEventListener(\"input\", handleTargetInput);\n  };\n};\n\nfunction normaliseConfig(config: unknown): AutoSlugConfig {\n  if (typeof config === \"string\") {\n    return { source: config };\n  }\n  if (config && typeof config === \"object\") {\n    const record = config as Record<string, unknown>;\n    const source = typeof record.source === \"string\" ? record.source : undefined;\n    return { source };\n  }\n  return {};\n}\n", "import type { BehaviorFactory, BehaviorTeardown } from \"./types\";\nimport {\n  collectBehaviorElements,\n  normalizeBehaviorName,\n  parseBehaviorConfig,\n  parseBehaviorNames,\n  resolveRootElement,\n  selectBehaviorConfig,\n} from \"./utils\";\n\ntype DisposeFn = (() => void) | undefined;\n\ninterface BehaviorRecord {\n  element: HTMLElement;\n  name: string;\n  dispose?: DisposeFn;\n}\n\nexport interface BehaviorInitResult {\n  dispose(): void;\n  records: BehaviorRecord[];\n}\n\nconst factories = new Map<string, BehaviorFactory>();\nlet instances = new WeakMap<HTMLElement, Map<string, DisposeFn>>();\n\nexport function registerBehavior(name: string, factory: BehaviorFactory): void {\n  const normalized = normalizeBehaviorName(name);\n  if (!normalized || typeof factory !== \"function\") {\n    return;\n  }\n  factories.set(normalized, factory);\n}\n\nexport function initBehaviors(root: Document | HTMLElement = document): BehaviorInitResult {\n  const elements = collectBehaviorElements(root);\n  const records: BehaviorRecord[] = [];\n\n  for (const element of elements) {\n    const names = parseBehaviorNames(element.getAttribute(\"data-behavior\"));\n    if (names.length === 0) {\n      continue;\n    }\n    const configPayload = parseBehaviorConfig(element.getAttribute(\"data-behavior-config\"));\n    const scopeRoot = resolveRootElement(element, root);\n\n    for (const rawName of names) {\n      const normalized = normalizeBehaviorName(rawName);\n      if (!normalized) {\n        continue;\n      }\n\n      if (hasActiveInstance(element, normalized)) {\n        continue;\n      }\n\n      const factory = factories.get(normalized);\n      if (!factory) {\n        console.warn(`[formgen:behaviors] behavior \"${normalized}\" is not registered.`);\n        continue;\n      }\n\n      const contextConfig = selectBehaviorConfig(configPayload, normalized, names.length);\n      const dispose = invokeFactory(factory, {\n        element,\n        name: normalized,\n        root: scopeRoot,\n        config: contextConfig,\n      });\n\n      setActiveInstance(element, normalized, dispose);\n      records.push({ element, name: normalized, dispose });\n    }\n  }\n\n  return {\n    records,\n    dispose: () => {\n      for (const record of records.splice(0)) {\n        if (record.dispose) {\n          try {\n            record.dispose();\n          } catch (error) {\n            console.warn(`[formgen:behaviors] dispose failed for ${record.name}:`, error);\n          }\n        }\n        clearActiveInstance(record.element, record.name);\n      }\n    },\n  };\n}\n\nexport function resetBehaviorRegistry(): void {\n  factories.clear();\n  instances = new WeakMap();\n}\n\nfunction invokeFactory(factory: BehaviorFactory, context: Parameters<BehaviorFactory>[0]): DisposeFn {\n  let teardown: BehaviorTeardown;\n  try {\n    teardown = factory(context);\n  } catch (error) {\n    console.warn(`[formgen:behaviors] factory for \"${context.name}\" failed:`, error);\n    return undefined;\n  }\n  if (typeof teardown === \"function\") {\n    return teardown;\n  }\n  if (teardown && typeof teardown === \"object\" && typeof teardown.dispose === \"function\") {\n    return () => teardown.dispose();\n  }\n  return undefined;\n}\n\nfunction getInstanceMap(element: HTMLElement): Map<string, DisposeFn> {\n  let map = instances.get(element);\n  if (!map) {\n    map = new Map();\n    instances.set(element, map);\n  }\n  return map;\n}\n\nfunction hasActiveInstance(element: HTMLElement, name: string): boolean {\n  const map = instances.get(element);\n  return map ? map.has(name) : false;\n}\n\nfunction setActiveInstance(element: HTMLElement, name: string, dispose: DisposeFn): void {\n  getInstanceMap(element).set(name, dispose);\n}\n\nfunction clearActiveInstance(element: HTMLElement, name: string): void {\n  const map = instances.get(element);\n  if (!map) {\n    return;\n  }\n  map.delete(name);\n  if (map.size === 0) {\n    instances.delete(element);\n  }\n}\n"],
  "mappings": ";;;;ocAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,8BAAAE,EAAA,aAAAC,EAAA,kBAAAC,EAAA,qBAAAC,EAAA,YAAAC,ICAO,SAASC,EAAQC,EAAuB,CAC7C,OAAKA,EAGEA,EACJ,UAAU,MAAM,EAChB,QAAQ,mBAAoB,EAAE,EAC9B,QAAQ,mBAAoB,GAAG,EAC/B,KAAK,EACL,QAAQ,WAAY,GAAG,EACvB,QAAQ,WAAY,EAAE,EACtB,YAAY,EATN,EAUX,CAEO,SAASC,EAAsBC,EAAsB,CAd5D,IAAAC,EAeE,OAAOA,EAAAD,GAAA,YAAAA,EAAM,OAAO,gBAAb,KAAAC,EAA8B,EACvC,CAEO,SAASC,EAAwBC,EAA6C,CACnF,IAAMC,GAAQD,aAAgB,SAAWA,GACnCE,EAAW,MAAM,KAAKD,EAAM,iBAA8B,iBAAiB,CAAC,EAClF,OAAID,aAAgB,aAAeA,EAAK,aAAa,eAAe,GAClEE,EAAS,QAAQF,CAAI,EAEhBE,CACT,CAEO,SAASC,EAAmBC,EAA8B,CAC/D,GAAI,CAACA,EACH,MAAO,CAAC,EAEV,IAAMC,EAASD,EACZ,MAAM,QAAQ,EACd,IAAKE,GAAUV,EAAsBU,CAAK,CAAC,EAC3C,OAAO,OAAO,EACjB,OAAO,MAAM,KAAK,IAAI,IAAID,CAAM,CAAC,CACnC,CAEO,SAASE,EAAoBH,EAA6B,CAC/D,GAAKA,EAGL,GAAI,CACF,OAAO,KAAK,MAAMA,CAAG,CACvB,OAASI,EAAO,CACd,QAAQ,KAAK,4DAA6DA,CAAK,EAC/E,MACF,CACF,CAEO,SAASC,EAAqBC,EAAiBb,EAAcc,EAAwB,CAC1F,GAAID,GAAU,OAAOA,GAAW,UAAYA,IAAW,KAAM,CAC3D,IAAME,EAASF,EACf,OAAI,OAAO,UAAU,eAAe,KAAKE,EAAQf,CAAI,EAC5Ce,EAAOf,CAAI,EAEhBc,IAAU,EACLD,EAET,MACF,CACA,GAAIC,IAAU,EACZ,OAAOD,CAGX,CAEO,SAASG,EAAmBC,EAAsBb,EAA4C,CAnErG,IAAAH,EAAAiB,EAAAC,EAoEE,IAAMC,EAAUH,EAAQ,QAAqB,0BAA0B,EACvE,OAAIG,IAGAhB,aAAiB,YACZA,GAEFe,GAAAD,EAAAd,EAAM,OAAN,KAAAc,GAAcjB,EAAAgB,EAAQ,gBAAR,YAAAhB,EAAuB,OAArC,KAAAkB,EAA6CF,EACtD,CAEO,SAASI,EACdC,EACgD,CAChD,MACE,CAAC,CAACA,IACDA,aAAgB,kBAAoBA,aAAgB,oBAEzD,CAEO,SAASC,EAAiBN,EAAqE,CACpG,OAAII,EAAeJ,CAAO,EACjBA,EAEFA,EAAQ,cAAsD,iBAAiB,CACxF,CAEO,SAASO,EACdrB,EACAsB,EAC+C,CAjGjD,IAAAxB,EAkGE,GAAI,CAACwB,EACH,OAAO,KAET,IAAMC,EAAe,UAAUD,CAAG,KAC5BE,EAAa,IAAIC,EAAeH,CAAG,CAAC,GAC1C,OACExB,EAAAE,EAAK,cAAsDuB,CAAY,IAAvE,KAAAzB,EACAE,EAAK,cAAsDwB,CAAU,CAEzE,CAEO,SAASC,EAAeH,EAAqB,CAClD,IAAMI,EAAUJ,EAAI,QAAQ,kBAAmB,GAAG,EAClD,OAAOI,EAAQ,WAAW,KAAK,EAAIA,EAAU,MAAMA,CAAO,EAC5D,CCzGO,IAAMC,EAA4B,CAAC,CAAE,QAAAC,EAAS,OAAAC,EAAQ,KAAAC,CAAK,IAAM,CACtE,IAAMC,EAASC,EAAiBJ,CAAO,EACvC,GAAI,CAACG,EAAQ,CACX,QAAQ,KAAK,oEAAoE,EACjF,MACF,CAEA,IAAME,EAAUC,EAAgBL,CAAM,EACtC,GAAI,CAACI,EAAQ,OAAQ,CACnB,QAAQ,KAAK,iEAAiE,EAC9E,MACF,CAEA,IAAME,EAASC,EAAeN,EAAMG,EAAQ,MAAM,EAClD,GAAI,CAACE,EAAQ,CACX,QAAQ,KAAK,qCAAqCF,EAAQ,MAAM,2BAA2B,EAC3F,MACF,CAEA,IAAII,EAAU,GACVC,EAASV,EAAQ,aAAa,qBAAqB,IAAM,SAEzD,CAACU,GAAUP,EAAO,MAAM,KAAK,EAAE,OAAS,IAC1CO,EAAS,GACTV,EAAQ,aAAa,sBAAuB,QAAQ,GAGtD,IAAMW,EAAa,IAAM,CACvB,GAAID,EACF,OAEF,IAAME,EAAYC,EAAQN,EAAO,OAAS,EAAE,EACxCK,IAAcT,EAAO,QAGzBM,EAAU,GACVN,EAAO,MAAQS,EACfT,EAAO,cAAc,IAAI,MAAM,QAAS,CAAE,QAAS,EAAK,CAAC,CAAC,EAC1DM,EAAU,GACZ,EAEMK,EAAoB,IAAM,CAC9BH,EAAW,CACb,EAEMI,EAAqBC,GAAiB,CAC1C,GAAIP,EACF,OAGF,GADgBN,EAAO,MAAM,KAAK,EACtB,SAAW,EAAG,CACxBO,EAAS,GACTV,EAAQ,gBAAgB,qBAAqB,EAC7CW,EAAW,EACX,MACF,CACAD,EAAS,GACTV,EAAQ,aAAa,sBAAuB,QAAQ,CACtD,EAEA,OAAAO,EAAO,iBAAiB,QAASO,CAAiB,EAClDX,EAAO,iBAAiB,QAASY,CAAiB,EAElDJ,EAAW,EAEJ,IAAM,CACXJ,EAAO,oBAAoB,QAASO,CAAiB,EACrDX,EAAO,oBAAoB,QAASY,CAAiB,CACvD,CACF,EAEA,SAAST,EAAgBL,EAAiC,CACxD,GAAI,OAAOA,GAAW,SACpB,MAAO,CAAE,OAAQA,CAAO,EAE1B,GAAIA,GAAU,OAAOA,GAAW,SAAU,CACxC,IAAMgB,EAAShB,EAEf,MAAO,CAAE,OADM,OAAOgB,EAAO,QAAW,SAAWA,EAAO,OAAS,MACnD,CAClB,CACA,MAAO,CAAC,CACV,CCjEA,IAAMC,EAAY,IAAI,IAClBC,EAAY,IAAI,QAEb,SAASC,EAAiBC,EAAcC,EAAgC,CAC7E,IAAMC,EAAaC,EAAsBH,CAAI,EACzC,CAACE,GAAc,OAAOD,GAAY,YAGtCJ,EAAU,IAAIK,EAAYD,CAAO,CACnC,CAEO,SAASG,EAAcC,EAA+B,SAA8B,CACzF,IAAMC,EAAWC,EAAwBF,CAAI,EACvCG,EAA4B,CAAC,EAEnC,QAAWC,KAAWH,EAAU,CAC9B,IAAMI,EAAQC,EAAmBF,EAAQ,aAAa,eAAe,CAAC,EACtE,GAAIC,EAAM,SAAW,EACnB,SAEF,IAAME,EAAgBC,EAAoBJ,EAAQ,aAAa,sBAAsB,CAAC,EAChFK,EAAYC,EAAmBN,EAASJ,CAAI,EAElD,QAAWW,KAAWN,EAAO,CAC3B,IAAMR,EAAaC,EAAsBa,CAAO,EAKhD,GAJI,CAACd,GAIDe,EAAkBR,EAASP,CAAU,EACvC,SAGF,IAAMD,EAAUJ,EAAU,IAAIK,CAAU,EACxC,GAAI,CAACD,EAAS,CACZ,QAAQ,KAAK,iCAAiCC,CAAU,sBAAsB,EAC9E,QACF,CAEA,IAAMgB,EAAgBC,EAAqBP,EAAeV,EAAYQ,EAAM,MAAM,EAC5EU,EAAUC,EAAcpB,EAAS,CACrC,QAAAQ,EACA,KAAMP,EACN,KAAMY,EACN,OAAQI,CACV,CAAC,EAEDI,EAAkBb,EAASP,EAAYkB,CAAO,EAC9CZ,EAAQ,KAAK,CAAE,QAAAC,EAAS,KAAMP,EAAY,QAAAkB,CAAQ,CAAC,CACrD,CACF,CAEA,MAAO,CACL,QAAAZ,EACA,QAAS,IAAM,CACb,QAAWe,KAAUf,EAAQ,OAAO,CAAC,EAAG,CACtC,GAAIe,EAAO,QACT,GAAI,CACFA,EAAO,QAAQ,CACjB,OAASC,EAAO,CACd,QAAQ,KAAK,0CAA0CD,EAAO,IAAI,IAAKC,CAAK,CAC9E,CAEFC,EAAoBF,EAAO,QAASA,EAAO,IAAI,CACjD,CACF,CACF,CACF,CAEO,SAASG,GAA8B,CAC5C7B,EAAU,MAAM,EAChBC,EAAY,IAAI,OAClB,CAEA,SAASuB,EAAcpB,EAA0B0B,EAAoD,CACnG,IAAIC,EACJ,GAAI,CACFA,EAAW3B,EAAQ0B,CAAO,CAC5B,OAASH,EAAO,CACd,QAAQ,KAAK,oCAAoCG,EAAQ,IAAI,YAAaH,CAAK,EAC/E,MACF,CACA,GAAI,OAAOI,GAAa,WACtB,OAAOA,EAET,GAAIA,GAAY,OAAOA,GAAa,UAAY,OAAOA,EAAS,SAAY,WAC1E,MAAO,IAAMA,EAAS,QAAQ,CAGlC,CAEA,SAASC,EAAepB,EAA8C,CACpE,IAAIqB,EAAMhC,EAAU,IAAIW,CAAO,EAC/B,OAAKqB,IACHA,EAAM,IAAI,IACVhC,EAAU,IAAIW,EAASqB,CAAG,GAErBA,CACT,CAEA,SAASb,EAAkBR,EAAsBT,EAAuB,CACtE,IAAM8B,EAAMhC,EAAU,IAAIW,CAAO,EACjC,OAAOqB,EAAMA,EAAI,IAAI9B,CAAI,EAAI,EAC/B,CAEA,SAASsB,EAAkBb,EAAsBT,EAAcoB,EAA0B,CACvFS,EAAepB,CAAO,EAAE,IAAIT,EAAMoB,CAAO,CAC3C,CAEA,SAASK,EAAoBhB,EAAsBT,EAAoB,CACrE,IAAM8B,EAAMhC,EAAU,IAAIW,CAAO,EAC5BqB,IAGLA,EAAI,OAAO9B,CAAI,EACX8B,EAAI,OAAS,GACfhC,EAAU,OAAOW,CAAO,EAE5B,CHzIAsB,EAAiB,EAEjB,SAASA,GAAyB,CAChCC,EAAiB,WAAYC,CAAQ,CACvC,CAMO,SAASC,GAAiC,CAC/CC,EAAsB,EACtBC,EAAiB,CACnB",
  "names": ["behaviors_exports", "__export", "__resetBehaviorsForTests", "autoSlug", "initBehaviors", "registerBehavior", "slugify", "slugify", "input", "normalizeBehaviorName", "name", "_a", "collectBehaviorElements", "root", "scope", "elements", "parseBehaviorNames", "raw", "tokens", "token", "parseBehaviorConfig", "error", "selectBehaviorConfig", "parsed", "total", "record", "resolveRootElement", "element", "_b", "_c", "nearest", "isInputControl", "node", "findNearestInput", "findFieldInput", "key", "attrSelector", "idSelector", "buildElementID", "escaped", "autoSlug", "element", "config", "root", "target", "findNearestInput", "options", "normaliseConfig", "source", "findFieldInput", "syncing", "manual", "updateSlug", "nextValue", "slugify", "handleSourceInput", "handleTargetInput", "event", "record", "factories", "instances", "registerBehavior", "name", "factory", "normalized", "normalizeBehaviorName", "initBehaviors", "root", "elements", "collectBehaviorElements", "records", "element", "names", "parseBehaviorNames", "configPayload", "parseBehaviorConfig", "scopeRoot", "resolveRootElement", "rawName", "hasActiveInstance", "contextConfig", "selectBehaviorConfig", "dispose", "invokeFactory", "setActiveInstance", "record", "error", "clearActiveInstance", "resetBehaviorRegistry", "context", "teardown", "getInstanceMap", "map", "registerDefaults", "registerBehavior", "autoSlug", "__resetBehaviorsForTests", "resetBehaviorRegistry", "registerDefaults"]
}
