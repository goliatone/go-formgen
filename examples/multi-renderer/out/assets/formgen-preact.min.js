(function(global){"use strict";function byId(id){return document.getElementById(id);}function safeID(value){if(!value){return "field";}return String(value).replace(/[^a-zA-Z0-9-_:.]/g,"-");}function readPayload(node){if(!node){return null;}var text=node.textContent||node.innerText||"";if(!text){return null;}try{return JSON.parse(text);}catch(err){console.error("formgen preact: failed to parse payload",err);return null;}}function ensurePreact(){var api=global.preact||{};if(typeof api.h!=="function"||typeof api.render!=="function"){console.warn("formgen preact: window.preact missing; rendering fallback pre block");return null;}return api;}function text(value){return value==null?"":String(value);}function optionList(h,field){var current=text(field["default"]);return (field.enum||[]).map(function(entry){var label=text(entry);var attrs={value:label};if(label===current){attrs.selected="selected";}return h("option",attrs,label);});}function controlForField(h,field,id){var inputClass="fg-preact-input";if(field.nested&&field.nested.length){return h("div",{class:"fg-preact-nested"},buildFieldList(h,field.nested));}if((field.enum||[]).length>0){return h("select",{id:id,name:field.name,class:inputClass,required:!!field.required},optionList(h,field));}var type=String(field.type||"string");if(type==="boolean"){var attrs={type:"checkbox",id:id,name:field.name,class:inputClass};if(field["default"]===true){attrs.checked="checked";}return h("input",attrs);}if(type==="integer"||type==="number"){return h("input",{type:"number",step:type==="integer"?"1":"any",id:id,name:field.name,class:inputClass,required:!!field.required,value:text(field["default"])});}return h("input",{type:"text",id:id,name:field.name,class:inputClass,required:!!field.required,value:text(field["default"])});}function buildFieldList(h,fields){return (fields||[]).map(function(field){var id="fg-"+safeID(field.name||field.label);var label=field.label||field.name||"Field";var children=[h("label",{class:"fg-preact-label",htmlFor:id},label,field.required?h("span",{class:"fg-preact-required"}," *"):null)];children.push(controlForField(h,field,id));if(field.description){children.push(h("p",{class:"fg-preact-help"},field.description));}return h("div",{class:"fg-preact-field"},children);});}function mountFallback(target,data){target.textContent=JSON.stringify(data,null,2);}function bootstrap(){var mount=byId("formgen-preact-root");var dataNode=byId("formgen-preact-data");if(!mount||!dataNode){return;}var model=readPayload(dataNode)||{operationId:"",fields:[]};var api=ensurePreact();if(!api){mountFallback(mount,model);return;}var h=api.h;var render=api.render;function App(){return h("section",{class:"fg-preact"},[h("h1",{class:"fg-preact-heading"},model.summary||model.operationId||"Generated Form"),model.description?h("p",{class:"fg-preact-description"},model.description):null,h("form",{class:"fg-preact-form",noValidate:"noValidate"},buildFieldList(h,model.fields))]);}render(h(App,null),mount);}if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",bootstrap);}else{bootstrap();}})(window);
